<?xml version="1.0" encoding="UTF-8"?>
<rules
    xmlns="http://namespaces.plone.org/diazo" 
    xmlns:css="http://namespaces.plone.org/diazo/css"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    css:if-content="#visual-portal-wrapper"
    >

    <!-- Homepage -->
    <rules css:if-content=".tile-frontpage">
        <theme href="homepage.html" />
        <drop css:content="#viewlet-above-content" method="raw" />
        <replace css:theme-children="#site-body .page">
            <div class="container">
                <xsl:copy-of css:select="#portal-column-content" />
            </div>
        </replace>
    </rules>

    <rules css:if-content="#catalogue-app">
        <theme href="catalogue.html" />
        <replace css:theme-children="#site-body .page">
            <div class="container">
                <xsl:copy-of css:select="#portal-column-content" method="raw" />
            </div>
        </replace>
    </rules>

    <!-- Regular pages: -->
    <rules if="$is_inside_page" >
        <theme href="folder.html" />
    </rules>

    Fallback theme
    <theme href="folder.html" />

    <!-- =============[ Head ]============= -->
    <copy css:content="html" css:theme="html" attributes="lang dir" />
    <drop css:theme="head script" />
    <before css:content="head style, head link, head script, head meta" css:theme-children="head" />
    <replace css:content="head title" css:theme="head title" />
    <copy css:content="head base" css:theme="head base" />
    <drop css:content="head link[rel='canonical']" />
    <drop css:content="head link[rel='shortcut icon']" />
    <drop css:content="head link[rel='apple-touch-icon']" />

    <!-- ===========[ Content ]============= -->
    <merge attributes="class" css:content="body" css:theme="body" />
    <copy attributes="id dir" css:content="body" css:theme="body" />

    <!-- Site header -->

    <!-- Main navigation menu -->
    <replace css:theme="#navmenu-primary" css:content="#navmenu-primary" />

    <append css:content="#portal-personaltools" css:theme="#navbar .navbar-header" />

    <!-- Site search form -->
    <merge attributes="action" css:theme="#navbar .navbar-search-form" css:content="#searchbar-options form" />

    <!-- Columns -->
    <replace css:content-children="#portal-column-one" css:theme="aside" />
    <replace css:content="#portal-column-content" css:theme=".article-body" />
<!-- viewlet&#45;below&#45;content&#45;body -->
    <!-- Move the editor bar above the main content (article) -->
    <drop css:content="#edit-bar" />
    <before css:theme="article" css:content="#edit-bar" method="raw" />

    <!-- Move the breadcrumbs -->
    <drop css:content="#portal-breadcrumbs" />
    <replace css:not-if-content="tile-frontpage" css:theme="nav .breadcrumbs" css:content="#portal-breadcrumbs" method="raw" />

    <!-- Drop the theme H1 title -->
    <drop css:theme="article h1" />

    <!-- Footer work -->
    <replace css:theme-children="#site-footer nav" css:content="#personalbar-options" />

    <!-- TODO: use xslt transformation to get this right -->
    <replace css:theme-children=".footer-logos" css:content="#editable-footer a" />

    <!-- TODO: enable back this, disabled during development -->
    <drop css:content="#viewlet-social-like" />

</rules>
